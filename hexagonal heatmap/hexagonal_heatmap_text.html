<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" > 
    <meta name="author" content="Agustin Fernández Felguera">

    <link rel="stylesheet" href="../styles.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="../main.js"></script> 

    <title>Hexagonal heatmap</title>

  </head>

<!-- Last updated: 3 September 2021 -->


  <body>
    <div id="circularcursor"></div>

    <h1>Hexagonal heatmap</h1>

<p>
I was watching some videos about a ML competition SLICED <a href="https://juliasilge.com/blog/nyc-airbnb/">here</a>, 
and I saw the use of what I thought was a very interesting plot and it is called hexagonal heatmap. It is very useful to represent the density of geographical data, where you have three dimensions: Longitude, latitude and the variable of interest.
In particular, the hexagons are very useful to avoid overplotting. 
<b> Overplotting </b> happens when the data or labels in a data visualization overlap, making it difficult to see individual data points in a data visualization.
</p>

<p>
If the amount of overplotting is low, you may be able to alleviate the problem by using smaller points, or by using a different shape (like shape 1, a hollow circle) 
through which other points can be seen.
If there’s a high degree of overplotting, there are a number of possible solutions:
</p>

<ul>
  <li>Make the points semi-transparent</li>
  <li>Bin the data into rectangles (better for quantitative analysis)</li>
  <li>Bin the data into hexagons</li>
  <li>Use box plots (when possible)</li>
  <li>Jitter points</li>
</ul>


<!-- 
Prices of 50,000 round cut diamonds, according to their carat (weight).  
<figure>
  <img class= "R_output" src="ejemplo_hex_diamonds.png">  
  <figcaption>Fig 0. Example hexagonal map</figcaption>
</figure>
-->

</p>
</p>


  <h2>Trying the plot in Barcelona airbnb's data</h2>

</p>
I used ggplot2.

</p>


<p>
A bit of explanation is here <a href="https://r-graphics.org/recipe-scatter-overplot">r-graphics.org</a>.

    <a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">Documentation of geom_hex</a>
    <a href="http://varianceexplained.org/r/sliced-ml/?utm_source=pocket_mylist">here</a>

    Google Maps Platform, overview
    <a href="https://developers.google.com/maps/documentation/maps-static/overview">here</a>
    

    In making these plots I spent theoretically 0.1 euros using the Geocoding API of Google Maps. Though they currently give you a credit of 255 euros for 90 days, so I actually use the service for free. 

  </p>

<p>
It's important to consider how many points are per hexagon (or bin). I there are very few the average may not be very informative (overfitting), if there are too much (and too few bins) you will not be able to see the differences.
</p>


<figure>
  <img class= "R_output" src="hex_heatmap.png">  
  <figcaption>Fig.1 - Hexagonal heatmap without map</figcaption>
</figure>

<p>
ggplot’s stat_density2d, which uses MASS::kde2d on the backend to estimate the density using a bivariate normal kernel.
</p>

<figure>
  <img class= "R_output" src="density_heatmap.png">   
  <figcaption>Fig.2 - Density heatmap</figcaption>
</figure>

</p>
We have to be cautious with images with a lot of points, this one weights 1.9 MB 
<p>

<figure>
  <img class= "R_output" src="points_map.png">   
  <figcaption>Fig.3 - Basic points in the map of Barcelona</figcaption>
</figure>


<figure>
  <img class= "R_output" src="agg_freq_map.png"> 
  <figcaption>Fig.4 - Aggregated frequency</figcaption>
</figure>     

<p>
It could be possible to combine number of listings and price in a single geom, price categorized.
</p>


The variation is not clear. 

<figure>
  <img class= "R_output" src="agg_hex_map.png">  
  <figcaption>Fig.5 - Hexagonal heatmap</figcaption>
</figure>



All the code can be found in <a href="https://github.com/Romanici/personalweb/blob/main/hexagonal%20heatmap/main_hex_plot.R">this file</a> uploaded to github.


  </body>


</html>